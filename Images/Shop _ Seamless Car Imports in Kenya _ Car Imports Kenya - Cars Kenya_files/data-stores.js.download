(()=>{const t=jQuery;let e=window.JetEngineRegisteredStores||{},s=window.JetEngineStores||{};function n(e){e.synch_id&&"string"==typeof e.synch_id&&e.synch_id.split(/[\s,]+/).map(t=>t.replace(/\s/,"")).filter(t=>!!t).forEach(function(n){let o=t("#"+n),i=o.find("> .elementor-widget-container");if(!o.length)return;let r=[],a=o.find(".jet-listing-grid__items").data("nav")||{},d=a.query||{},g=window.elementorFrontendConfig?.post?.id||0;a=JetEngine.ensureJSON(a),o.hasClass("brxe-jet-engine-listing-grid")&&(g=window.bricksData.postId),o.hasClass("jet-listing-grid--blocks")&&(g=JetEngineSettings.post_id),e?.store?.is_front&&Object.keys(d).length&&(r=s[e.store.type].getStore(e.store.slug),r.length||(r=["is-front",e.store.type,e.store.slug]),d.front_store__in=r,d.is_front_store=!0);let l={handler:"get_listing",container:i.length?i:o,masonry:!1,slider:!1,append:!1,query:d,widgetSettings:a.widget_settings,postID:g,elementID:o.data("id")};JetEngine.ajaxGetListing(l,function(t){JetEngine.widgetListingGrid(o)})})}function o(t,e){var s,n,o,i=t.hasClass("jet-data-store-link"),r=t.find(".jet-listing-dynamic-link__label, .jet-data-store-link__label"),a=t.find(".jet-listing-dynamic-link__icon, .jet-data-store-link__icon"),d=t.data("args");if(d=JetEngine.ensureJSON(d),e=e||!1,i)switch(d.action_after_added){case"remove_from_store":e?(t.addClass("jet-add-to-store"),t.removeClass("jet-remove-from-store"),t.removeClass("in-store")):(t.addClass("jet-remove-from-store"),t.removeClass("jet-add-to-store"),t.addClass("in-store"));break;case"hide":return void(e?t.removeClass("is-hidden"):t.addClass("is-hidden"))}e?(s=d.label,o=d.icon,n="#"):(s=d.added_label,o=d.added_icon,n=d.added_url),r.length?r.replaceWith(s):t.append(s),a.length?a.replaceWith(o):t.prepend(o),i&&"remove_from_store"===d.action_after_added||(t.attr("href",n),e?t.removeClass("in-store"):t.hasClass("in-store")||t.addClass("in-store"))}function i(){JetEngine.initFrontStores(),t.each(e,function(e,n){var o,i=s[n],r=0;i&&((o=i.getStore(e))&&o.length&&(r=o.length),t('span.jet-engine-data-store-count[data-store="'+e+'"]').text(r))}),JetEngine.loadFrontStoresItems()}function r(e){e=e||t("body"),t(".jet-add-to-store.is-front-store",e).each(function(){var e=t(this),n=e.data("args"),o=s[n.store.type];n=JetEngine.ensureJSON(n),o&&o.inStore(n.store.slug,""+n.post_id)&&JetEngine.switchDataStoreStatus(e)}),t(".jet-remove-from-store.is-front-store",e).each(function(){var e=t(this),n=e.data("args"),o=s[n.store.type];n=JetEngine.ensureJSON(n),o&&(o.inStore(n.store.slug,""+n.post_id)?e.removeClass("is-hidden"):e.addClass("is-hidden"))})}function a(e){e=e||t("body"),t(".jet-listing-not-found.jet-listing-grid__items",e).each(function(){var e=t(this),n=e.data("nav"),o=e.data("is-store-listing"),i=n.query||{};if(n=JetEngine.ensureJSON(n),i&&i.post__in&&i.post__in.length&&0>=i.post__in.indexOf("is-front")){var r,a=i.post__in[1],d=i.post__in[2],g=s[a],l=e.closest(".jet-listing-grid");if(!g)return;if(l.length||(l=e.closest(".jet-listing-grid--blocks")),l.length||(l=e.closest(".brxe-jet-engine-listing-grid")),!(r=g.getStore(d)).length)return;i.front_store__in=r,i.is_front_store=!0,JetEngine.ajaxGetListing({handler:"get_listing",container:l,masonry:!1,slider:!1,append:!1,query:i,widgetSettings:n.widget_settings},function(t){JetEngine.widgetListingGrid(l)})}else o&&t(document).trigger("jet-listing-grid-init-store",e)})}function d(e){e.preventDefault(),e.stopPropagation();var n=t(this),o=n.data("args");if(o=JetEngine.ensureJSON(o),n.hasClass("in-store"))o.popup?JetEngine.triggerPopup(o.popup,o.isJetEngine,o.post_id):"_blank"===n.attr("target")?window.open(n.attr("href")):window.location=n.attr("href");else{if(o.store.is_front){var i=s[o.store.type],r=0;if(!i)return;if(i.inStore(o.store.slug,""+o.post_id))r=i.getStore(o.store.slug).length;else if(!1===(r=i.addToStore(o.store.slug,o.post_id,o.store.size)))return;return o.popup&&JetEngine.triggerPopup(o.popup,o.isJetEngine,o.post_id),JetEngine.switchDataStoreStatus(n),t('span.jet-engine-data-store-count[data-store="'+o.store.slug+'"]').text(r),t('.jet-remove-from-store[data-store="'+o.store.slug+'"][data-post="'+o.post_id+'"]').removeClass("is-hidden"),JetEngine.dataStoreSyncListings(o),void t(document).trigger("jet-engine-data-stores-on-add",o)}n.hasClass("jet-store-processing")||(n.css("opacity",.3),n.addClass("jet-store-processing"),t(document).trigger("jet-engine-on-add-to-store",[n,o]),JetEngine.dataStores.addToQueue(o.store.slug,()=>t.ajax({url:JetEngineSettings.ajaxurl,type:"POST",dataType:"json",data:{action:"jet_engine_add_to_store_"+o.store.slug,store:o.store.slug,post_id:o.post_id}}).done(function(e){return n.css("opacity",1),n.removeClass("jet-store-processing"),e.success?(JetEngine.switchDataStoreStatus(n),t('.jet-remove-from-store[data-store="'+o.store.slug+'"][data-post="'+o.post_id+'"]').removeClass("is-hidden"),e.data.fragments&&t.each(e.data.fragments,function(e,s){t(e).html(s)}),JetEngine.dataStoreSyncListings(o),o.popup&&JetEngine.triggerPopup(o.popup,o.isJetEngine,o.post_id)):alert(e.data.message),t(document).trigger("jet-engine-data-stores-on-add",o),e}).done(function(e){e.success&&t('span.jet-engine-data-store-count[data-store="'+o.store.slug+'"]').text(e.data.count)}).fail(function(t,e,s){n.css("opacity",1),n.removeClass("jet-store-processing"),alert(s)})))}}function g(e){e.preventDefault(),e.stopPropagation();var n=t(this),o=n.data("args"),i=n.hasClass("jet-data-store-link");if((o=JetEngine.ensureJSON(o)).store.is_front){var r=s[o.store.type],a=0;if(!r)return;return a=r.inStore(o.store.slug,""+o.post_id)?r.remove(o.store.slug,o.post_id):r.getStore(o.store.slug).length,t('.jet-add-to-store[data-store="'+o.store.slug+'"][data-post="'+o.post_id+'"]').each(function(){JetEngine.switchDataStoreStatus(t(this),!0)}),t('.jet-data-store-link.jet-remove-from-store[data-store="'+o.store.slug+'"][data-post="'+o.post_id+'"]').each(function(){JetEngine.switchDataStoreStatus(t(this),!0)}),t('span.jet-engine-data-store-count[data-store="'+o.store.slug+'"]').text(a),o.remove_from_listing&&n.closest(".jet-listing-dynamic-post-"+o.post_id).remove(),JetEngine.dataStoreSyncListings(o),void t(document).trigger("jet-engine-data-stores-on-remove",o)}n.hasClass("jet-store-processing")||(n.css("opacity",.3),n.addClass("jet-store-processing"),JetEngine.dataStores.addToQueue(o.store.slug,()=>t.ajax({url:JetEngineSettings.ajaxurl,type:"POST",dataType:"json",data:{action:"jet_engine_remove_from_store_"+o.store.slug,store:o.store.slug,post_id:o.post_id}}).done(function(e){return n.css("opacity",1),n.removeClass("jet-store-processing"),e.success?(i||n.addClass("is-hidden"),t('.jet-add-to-store[data-store="'+o.store.slug+'"][data-post="'+o.post_id+'"]').each(function(){JetEngine.switchDataStoreStatus(t(this),!0)}),t('.jet-data-store-link.jet-remove-from-store[data-store="'+o.store.slug+'"][data-post="'+o.post_id+'"]').each(function(){JetEngine.switchDataStoreStatus(t(this),!0)}),JetEngine.dataStoreSyncListings(o),o.remove_from_listing&&n.closest('.jet-listing-grid__item[data-post="'+o.post_id+'"]').remove(),e.data.fragments&&t.each(e.data.fragments,function(e,s){t(e).html(s)}),t(document).trigger("jet-engine-data-stores-on-remove",o)):alert(e.data.message),e}).done(function(e){o.remove_from_listing&&n.closest(".jet-listing-grid__item").remove(),e.success&&t('span.jet-engine-data-store-count[data-store="'+o.store.slug+'"]').text(e.data.count)}).fail(function(t,e,s){n.css("opacity",1),n.removeClass("jet-store-processing"),alert(s)})))}window.JetPlugins.hooks.addAction("jet-engine.modules-include","module-data-stores",function(e){e.addToStore=d,e.removeFromStore=g,e.initStores=i,e.initFrontStores=r,e.loadFrontStoresItems=a,e.dataStoreSyncListings=n,e.switchDataStoreStatus=o,e.dataStores={queues:{},getQueue:function(t){return this.queues?.[t]instanceof Promise||(this.queues[t]=Promise.resolve()),this.queues[t]},addToQueue:function(t,e){this.queues[t]=this.getQueue(t).then(e)}},t(window).on("jet-popup/render-content/ajax/success",e.initStores),t(document).on("jet-engine/listing/ajax-get-listing/done",function(t,s){e.initFrontStores(s)}).on("jet-engine/listing-grid/after-lazy-load",function(t,s,n,o){e.loadFrontStoresItems(o)}),e.initStores()}),window.JetPlugins.hooks.addAction("jet-engine.common-events","module-data-stores",function(t,e){t.on("click.JetEngine",".jet-add-to-store",e.addToStore).on("click.JetEngine",".jet-remove-from-store",e.removeFromStore)})})();